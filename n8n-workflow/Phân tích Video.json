{
  "name": "Ph√¢n t√≠ch Video",
  "nodes": [
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1hcFoYNhmJdizx5s2id8gl_iPz_74fp5cZYz0I1bAJH8",
          "mode": "list",
          "cachedResultName": "ATI",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1hcFoYNhmJdizx5s2id8gl_iPz_74fp5cZYz0I1bAJH8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 247030835,
          "mode": "list",
          "cachedResultName": "Source Ph√¢n t√≠ch Video",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1hcFoYNhmJdizx5s2id8gl_iPz_74fp5cZYz0I1bAJH8/edit#gid=247030835"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -304,
        -176
      ],
      "id": "7d5f1642-9690-46cb-a511-c53ddda82de0",
      "name": "L·∫•y subtitle",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "vOVL810O1YkyU621",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ed3b1ec3-e976-4dbf-b3db-98c06e8ae6b3",
              "name": "subtitle",
              "value": "={{ $json.fullText }}",
              "type": "string"
            },
            {
              "id": "86aab8b8-e6c6-467c-a538-880d26308fb9",
              "name": "keyword",
              "value": "={{ $json.keyword }}",
              "type": "string"
            },
            {
              "id": "7c3d1060-053d-40f5-a01b-a5a7b11b278b",
              "name": "url",
              "value": "={{ $json.url }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        320,
        -80
      ],
      "id": "6388cb23-2850-4723-876f-64d8d7c56e29",
      "name": "L·ªçc d·ªØ li·ªáu"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a5bedcfb-0810-447d-a308-008ece785a42",
              "name": "output",
              "value": "={{ $json.content.parts[0].text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        816,
        -80
      ],
      "id": "25a1ffc7-b8b2-4d49-a45b-899b6c360515",
      "name": "L·∫•y output"
    },
    {
      "parameters": {
        "jsCode": "function formatObject(obj) {\n  let text = \"\";\n  if (!obj) return \"\"; // Tr·∫£ v·ªÅ chu·ªói r·ªóng n·∫øu obj kh√¥ng t·ªìn t·∫°i\n\n  for (const [key, value] of Object.entries(obj)) {\n    // Vi·∫øt hoa ch·ªØ c√°i ƒë·∫ßu ti√™n c·ªßa 'key' (vd: 'hook' -> 'Hook')\n    const formattedKey = key.charAt(0).toUpperCase() + key.slice(1);\n    text += `‚Ä¢ ${formattedKey}: ${value}\\n`; // Th√™m d·∫•u ‚Ä¢ v√† xu·ªëng d√≤ng\n  }\n  return text.trim(); // X√≥a d√≤ng tr·ªëng cu·ªëi c√πng\n}\n\n// --- B·∫ÆT ƒê·∫¶U CODE CH√çNH ---\n\ntry {\n  // 1. L·∫•y v√† ph√¢n t√≠ch chu·ªói JSON\n  const jsonString = $input.first().json.output;\n  const parsedData = JSON.parse(jsonString);\n\n  // L·∫•y 'marketing_analysis' t·ª´ 'parsedData'\n  const analysis = parsedData.marketing_analysis;\n  let analysisSummary = \"\";\n\n  // 2. T·ª∞ ƒê·ªòNG KI·ªÇM TRA C·∫§U TR√öC (Ph·∫ßn n√†y gi·ªØ nguy√™n, v√¨ n√≥ an to√†n)\n  if (analysis?.strengths || analysis?.weaknesses) {\n    // --- X·ª≠ l√Ω c·∫•u tr√∫c l·ªìng (ph·ª©c t·∫°p) ---\n    if (analysis.strengths) {\n      analysisSummary += \"‚úÖ ƒêI·ªÇM M·∫†NH:\\n\";\n      analysisSummary += formatObject(analysis.strengths) + \"\\n\\n\";\n    }\n    if (analysis.weaknesses) {\n      analysisSummary += \"‚ùå ƒêI·ªÇM Y·∫æU:\\n\";\n      analysisSummary += formatObject(analysis.weaknesses) + \"\\n\\n\";\n    }\n    if (analysis.improvement_suggestions) {\n      analysisSummary += \"üí° G·ª¢I √ù C·∫¢I THI·ªÜN:\\n\";\n      analysisSummary += formatObject(analysis.improvement_suggestions);\n    }\n  } else if (analysis) { \n    analysisSummary = formatObject(analysis);\n  } else {\n    analysisSummary = \"Kh√¥ng c√≥ ph√¢n t√≠ch marketing.\";\n  }\n  return {\n    marketing_analysis: analysisSummary.trim()\n  };\n\n} catch (error) {\n  return { \n    error: \"L·ªói x·ª≠ l√Ω: \" + error.message, \n    original_data: $input.first().json.output \n  };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1024,
        -80
      ],
      "id": "5fa4a727-47a0-468b-9807-dbc9cfd11b3d",
      "name": "Chu·∫©n h√≥a d·ªØ li·ªáu"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "0fc63e31-4193-479c-9b7a-db9c619df25c",
              "leftValue": "={{ $json['check box'].toString() }}",
              "rightValue": "true",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -96,
        -176
      ],
      "id": "cb33f8c9-af5d-4a74-b286-8e595b3927b5",
      "name": "If"
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y to√†n b·ªô item ƒë·∫ßu v√†o\nconst input = $input.first().json;\n\n// 1. L·∫•y keyword\nconst keyword = input.keyword;\n\n// 2. L·∫•y url (TH√äM M·ªöI)\n// Ph·∫£i d√πng d·∫•u ngo·∫∑c vu√¥ng v√¨ t√™n c·ªôt \"Link video g·ªëc\" c√≥ d·∫•u c√°ch\nconst url = $input.first().json['Link Video g·ªëc'];\n\n// 3. L·∫•y fullText (Code c≈© c·ªßa b·∫°n)\nlet fullText = \"\";\nlet raw = input[\"subtitle video\"];\n\n// Ki·ªÉm tra xem 'subtitle video' c√≥ t·ªìn t·∫°i v√† kh√¥ng r·ªóng kh√¥ng\nif (raw) {\n¬† try {\n¬† ¬† // Lo·∫°i b·ªè d·∫•u ph·∫©y th·ª´a tr∆∞·ªõc d·∫•u }\n¬† ¬† raw = raw.replace(/,\\s*}/g, \"}\");\n¬† ¬†¬†\n¬† ¬† const data = JSON.parse(raw);\n\n¬† ¬† // L·∫•y danh s√°ch segment\n¬† ¬† const segments = data.all_segments || [];\n\n¬† ¬† // L·∫•y to√†n b·ªô text\n¬† ¬† const texts = segments.map(seg => seg.text);\n\n¬† ¬† // Gh√©p l·∫°i th√†nh text\n¬† ¬† fullText = texts.join(\" \");\n\n¬† } catch (error) {\n¬† ¬† // N·∫øu JSON b·ªã l·ªói, g√°n 'fullText' l√† th√¥ng b√°o l·ªói\n¬† ¬† fullText = \"L·ªói ph√¢n t√≠ch JSON: \" + error.message;\n¬† }\n} else {\n¬† // N·∫øu 'subtitle video' r·ªóng, g√°n 'fullText' l√† chu·ªói r·ªóng\n¬† fullText = \"\";\n}\n\n// 4. Tr·∫£ v·ªÅ c·∫£ ba (fullText, keyword, v√† url)\nreturn [{¬†\n¬† json: {¬†\n¬† ¬† fullText: fullText,\n¬† ¬† keyword: keyword,\n¬† ¬† url: url \n¬† }¬†\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        128,
        -80
      ],
      "id": "782c1f81-0af8-4f8e-87e6-0cfb11c364c0",
      "name": "L·ªçc subtitle"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.0-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.0-flash"
        },
        "messages": {
          "values": [
            {
              "content": "=ƒê·∫ßu v√†o: T√¥i s·∫Ω cung c·∫•p cho b·∫°n m·ªôt ƒëo·∫°n vƒÉn b·∫£n d∆∞·ªõi ƒë√¢y.\n\n{{ $json.subtitle }}"
            },
            {
              "content": "=B·ªëi c·∫£nh:\nB·∫°n l√† chuy√™n gia chi·∫øn l∆∞·ª£c n·ªôi dung v√† social media marketing. H√£y ph√¢n t√≠ch ƒëo·∫°n transcription c·ªßa video v√† t·∫°o ra ph·∫ßn marketing_analysis theo ƒë√∫ng c·∫•u tr√∫c JSON ƒë∆∞·ª£c quy ƒë·ªãnh d∆∞·ªõi ƒë√¢y.\n\n‚ñ∂ Y√äU C·∫¶U B·∫ÆT BU·ªòC\n\nH√£y xu·∫•t ra JSON duy nh·∫•t, lu√¥n theo ƒë√∫ng m·∫´u sau, kh√¥ng th√™m ho·∫∑c b·ªõt key:\n\n{\n  \"marketing_analysis\": {\n    \"strengths\": {\n      \"hook\": \"\",\n      \"value\": \"\",\n      \"cta\": \"\",\n      \"emotion_connection\": \"\"\n    },\n    \"weaknesses\": {\n      \"clarity\": \"\",\n      \"structure\": \"\",\n      \"engagement\": \"\"\n    },\n    \"improvement_suggestions\": {\n      \"clarity\": \"\",\n      \"structure\": \"\",\n      \"engagement\": \"\"\n    }\n  }\n}\n\n‚ñ∂ M√î T·∫¢ C√ÅC PH·∫¶N\nmarketing_analysis\n1. strengths\n\nhook ‚Üí Ph√¢n t√≠ch m·ª©c ƒë·ªô thu h√∫t c·ªßa 1‚Äì2 c√¢u m·ªü ƒë·∫ßu.\n\nvalue ‚Üí N·ªôi dung mang l·∫°i gi√° tr·ªã g√¨?\n\ncta ‚Üí C√≥ l·ªùi k√™u g·ªçi h√†nh ƒë·ªông kh√¥ng, hi·ªáu qu·∫£ kh√¥ng?\n\nemotion_connection ‚Üí M·ª©c ƒë·ªô c·∫£m x√∫c, storytelling, k·∫øt n·ªëi.\n\n2. weaknesses\n\nclarity ‚Üí C√≥ ƒëo·∫°n n√†o kh√≥ hi·ªÉu, d∆∞ th·ª´a, lan man?\n\nstructure ‚Üí M·∫°ch n·ªôi dung c√≥ h·ª£p l√Ω kh√¥ng? thi·∫øu m·ªü/k·∫øt?\n\nengagement ‚Üí Nh·ªØng ph·∫ßn d·ªÖ l√†m ng∆∞·ªùi xem r·ªùi ƒëi.\n\n3. improvement_suggestions\n\nƒê∆∞a ra gi·∫£i ph√°p c·ª• th·ªÉ t∆∞∆°ng ·ª©ng 1‚Äì1 v·ªõi 3 ƒëi·ªÉm y·∫øu ·ªü tr√™n:\n\nc·∫£i thi·ªán ƒë·ªô r√µ r√†ng\n\nc·∫£i thi·ªán c·∫•u tr√∫c\n\ntƒÉng engagement\n\n‚ñ∂ QUY T·∫ÆC B·∫ÆT BU·ªòC\n\nOutput ch·ªâ ƒë∆∞·ª£c ch·ª©a JSON, kh√¥ng gi·∫£i th√≠ch th√™m.\n\nKh√¥ng ƒë∆∞·ª£c ƒë·ªïi t√™n key JSON.\n\nKh√¥ng ƒë∆∞·ª£c th√™m markdown, emoji, ghi ch√∫.\n\nKh√¥ng ƒë∆∞·ª£c th√™m d·ªØ li·ªáu ngo√†i form m·∫´u.",
              "role": "model"
            }
          ]
        },
        "jsonOutput": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        512,
        -80
      ],
      "id": "3768086f-1efb-4dc7-acad-47d79de93293",
      "name": "T·∫°o Ph√¢n t√≠ch Video",
      "credentials": {
        "googlePalmApi": {
          "id": "IqddL1p8o4zaf999",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1hcFoYNhmJdizx5s2id8gl_iPz_74fp5cZYz0I1bAJH8",
          "mode": "list",
          "cachedResultName": "ATI",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1hcFoYNhmJdizx5s2id8gl_iPz_74fp5cZYz0I1bAJH8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 247030835,
          "mode": "list",
          "cachedResultName": "Source Ph√¢n t√≠ch Video",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1hcFoYNhmJdizx5s2id8gl_iPz_74fp5cZYz0I1bAJH8/edit#gid=247030835"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "check box": "true",
            "Link Video g·ªëc": "={{ $('L·ªçc d·ªØ li·ªáu').item.json.url }}",
            "Ph√¢n t√≠ch video": "={{ $json.marketing_analysis }}"
          },
          "matchingColumns": [
            "Link Video g·ªëc"
          ],
          "schema": [
            {
              "id": "keyword",
              "displayName": "keyword",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Link Video g·ªëc",
              "displayName": "Link Video g·ªëc",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "subtitle video",
              "displayName": "subtitle video",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "check box",
              "displayName": "check box",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Ph√¢n t√≠ch video",
              "displayName": "Ph√¢n t√≠ch video",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1248,
        -80
      ],
      "id": "bc90a9cf-5deb-4685-b542-df3afb50e4bb",
      "name": "Update Ph√¢n t√≠ch",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "vOVL810O1YkyU621",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "8b65e92c-33df-49a6-8949-6fd5cc524a2d",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -528,
        -176
      ],
      "id": "50b16a44-62a8-4a02-9b32-60b7d6069e74",
      "name": "Webhook",
      "webhookId": "8b65e92c-33df-49a6-8949-6fd5cc524a2d"
    }
  ],
  "pinData": {},
  "connections": {
    "L·∫•y subtitle": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "L·ªçc d·ªØ li·ªáu": {
      "main": [
        [
          {
            "node": "T·∫°o Ph√¢n t√≠ch Video",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "L·∫•y output": {
      "main": [
        [
          {
            "node": "Chu·∫©n h√≥a d·ªØ li·ªáu",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Chu·∫©n h√≥a d·ªØ li·ªáu": {
      "main": [
        [
          {
            "node": "Update Ph√¢n t√≠ch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [],
        [
          {
            "node": "L·ªçc subtitle",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "L·ªçc subtitle": {
      "main": [
        [
          {
            "node": "L·ªçc d·ªØ li·ªáu",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "T·∫°o Ph√¢n t√≠ch Video": {
      "main": [
        [
          {
            "node": "L·∫•y output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "L·∫•y subtitle",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "50bf5217-c5e5-4571-ab42-a79baf25e6a3",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "a5687956cb943cbcc3e67d5d6cee59a837afe62cbf4045df2f8ef234d6001617"
  },
  "id": "j9JfJerJhHxMijrl",
  "tags": []
}